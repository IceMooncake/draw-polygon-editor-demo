<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polygon Editor Demo</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }
        .container {
            display: flex;
            gap: 20px;
        }
        #image-wrapper {
            width: 800px;
            height: 600px;
            background-color: #f0f0f0;
            border: 2px solid #ccc;
        }
        #image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .sidebar {
            width: 600px;
        }
        .controls {
            margin-bottom: 20px;
            padding: 10px;
            background: #eee;
            border-radius: 4px;
        }
        button {
            margin: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        #output {
            white-space: pre-wrap;
            font-family: monospace;
            background: #333;
            color: #fff;
            padding: 10px;
            height: 454px;
            overflow: auto;
        }
    </style>
</head>
<body>

    <h1>Draw-Polygon Demo</h1>
    
    <div class="container">
        <div id="image-wrapper">
             <img src="./example.jpg" alt="Placeholder">
        </div>

        <div class="sidebar">
            <div class="controls">
                <button id="btn-toggle">开启/关闭遮罩 (open/close mask)</button>
                <button id="btn-reset">重置 (Reset)</button>
                <button id="btn-get">获取坐标 (Get Points)</button>
            </div>
            <h3>输出日志 (Output Log):</h3>
            <div id="output">...waiting...</div>
        </div>
    </div>
    
    <script type="module">
        import { PolygonEditor } from './dist/index.js';

        const wrapper = document.getElementById('image-wrapper');
        const output = document.getElementById('output');
        const btnToggle = document.getElementById('btn-toggle');
        const btnReset = document.getElementById('btn-reset');
        const btnGet = document.getElementById('btn-get');

        function log(msg) {
            output.textContent = msg + '\n' + output.textContent;
        }

        // init editor
        const editor = new PolygonEditor(wrapper, {
            lineDash: [4, 4],
            strokeColor: [
              'rgb(255, 99, 132)',
              '#1f6feb',
              '#1098ad',
              '#20c997',
              '#ff6f92',
            ],
            pointRadius: 3
        });

        // listen to events
        editor.setOnComplete((polygons) => {
            log(`[Complete] Polygon added. Total polygons: ${polygons.length}`);
        });

        // toggle enable/disable
        let isEnabled = true;
        btnToggle.onclick = () => {
            isEnabled = !isEnabled;
            if (isEnabled) {
                editor.enable();
                log('[Info] engine enabled (canvas visible)');
            } else {
                editor.disable();
                log('[Info] engine disabled (canvas hidden)');
            }
        };

        btnReset.onclick = () => {
             editor.reset();
             log('[Info] canvas reset');
        };

        btnGet.onclick = () => {
            const polys = editor.getPolygons();
            log(`[Data] Current polygons: ${polys.length} polygons.\n`);
            polys.forEach((p, i) => {
                log(`Polygon ${i + 1}: ${p.length} points. \n${JSON.stringify(p, null, 2)}`);
            });
            console.log(polys);
        };

        log('Tool is ready. \nClick on the image area to draw points. \nDouble-click to close. \nRight-click to undo. \nctrl + click to add a new point.');
    </script>
</body>
</html>
